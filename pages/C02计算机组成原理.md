<h1 align="center">计算机组成原理</h1>

## 计算机发展与结构

+ 计算机分**硬件**和**软件**，软件又分**系统软件**和**应用软件**

+ **发展历程**：电子管、晶体管、中小集成电路、超大集成电路

+ **两极化发展趋势**：微型化/网络化/高性能/多用途，巨型化/超高速/并行处理/智能化

| 著名人物  | 介绍                              |
|:-----:|:-------------------------------:|
| 威廉肖克利 | 晶体管之父，AMD/Intel创始人都出自其公司        |
| 桑德斯   | AMD创始人                          |
| 摩尔    | Intel创始人，摩尔定律：18个月性能提升一倍，价格降低一半 |

        **计算机结构**：

|     | 冯诺依曼结构           | 现代计算机结构      |
|:---:|:----------------:|:------------:|
| 设备  | 运算器、控制器、存储器、IO设备 | CPU、存储器、IO设备 |
| 中心  | 运算器              | 存储器          |

        **计算机多级层次结构**：

| 层次      | 别称     | 属于  | 说明             |
|:-------:|:------:|:---:|:--------------:|
| M0微指令机器 | 微指令机器  | 硬件  | CPU微指令，电路实现    |
| M1传统机器  | 机器语言机器 | 硬件  | 1条机器语言对应n条微指令  |
| M2虚拟机器  | 操作系统机器 | 软件  | \              |
| M3虚拟机器  | 汇编语言机器 | 软件  | 1条汇编语言对应n条机器语言 |
| M4虚拟机器  | 高级语言机器 | 软件  | 1条高级语言对应n条汇编语言 |

| 转换程序 | 说明                   | 例如            |
|:----:|:--------------------:|:-------------:|
| 汇编程序 | 将汇编语言转换为机器语言         | \             |
| 编译程序 | 将高级语言一次性转成机器语言       | C、C++、Java    |
| 解释程序 | 以一句翻译一次执行的方式，将高级转成机器 | JS、python、php |

---

## 二进制

        **概念**：用0、1表示所有数据。

        优点：**运算规则简单**，**可实现逻辑电路**，**契合硬件两个稳态**。

| n进制  | 尾巴表示法      | 头部表示法       |
|:----:|:----------:|:-----------:|
| 二进制  | 1010 **B** | \           |
| 八进制  | 4567 **O** | \           |
| 十进制  | 9876 **D** | \           |
| 十六进制 | CDEF **H** | **0x** CDEF |

        **进制数转换**

| 转换对象      | 方法         | 适用于 |
|:---------:|:----------:|:---:|
| 其他转十进制    | 权重法        | 通用  |
| 十进制整数转其他  | 除基取余，商继续除  | 通用  |
| 十进制小数转其他  | 乘基取整，小数继续乘 | 通用  |
| 二、八、十六间转换 | 对位法        | 技巧  |
| 十进制转二进制   | 拼凑法        | 技巧  |

---

### 编码

#### BCD码

        **概念**：用4位二进制数表示1位十进制数，但浪费6个表示组合。

| 分类    | 权值否  | 说明                            |
|:-----:|:----:|:-----------------------------:|
| 8421码 | 权值码  | 正常拼凑法                         |
| 余三码   | 非权值码 | 8421码偏移三位，0xxx对应0-4，1xxx对应5-9 |
| 2421码 | 权值码  | 拼凑必须按：0xxx对应0-4，1xxx对应5-9     |

 ---

#### ASCII码

        **概念**：用八位数表示了128个字符。八位数范围即0000 0000 - 0111 1111。

| 分类      | 内容           | 二进制                   | 特点             |
|:-------:|:------------:|:---------------------:|:--------------:|
| 可印刷字符   | **32**-126   | \                     | \              |
| 控制和通信字符 | 0-31、**127** | \                     | \              |
| 0-9     | **48**-57    | 0011 0000 - 0011 1001 | 0011 开头，后四位0-9 |
| A-Z     | **65**-90    | 0100 0001 - 0101 1010 | 010开头，后六位1-26  |
| a-z     | **97**-122   | 0110 0001 - 0111 1010 | 011开头，后六位1-26  |

---

#### GB2312-80汉字码

        **概念**：用94×94的矩阵存储和表示了7445个汉字。

+ 1个汉字**2个字节**的由来。

+ **国标码**的行号、列号分别+0010 0000，以区别ASCII码通信字符

+ **机内码**的行号、列号分别+1000 0000，以区别ASCII码全部字符。

+ 汉字输出用了汉字**字形码**。

---

### 校验码

        **码字**：代表某个字符的若干位数，如ASCII码某八位数代表1个码字。

        **码距**：码字间最少的不同位个数，反应了变多少个位可变成其他码字，一般都是1。

        **共同点**：都使用了异或运算（模2加运算）。

---

#### 奇偶校验码

        **特点**：有1/3/5/7...位检错，无纠错能力。

| 分类   | 说明                        |
|:----:|:-------------------------:|
| 奇校验码 | 添加1位校验位"0"或"1"，实现全位奇数个"1" |
| 偶校验码 | 添加1位校验位"0"或"1"，实现全位偶数个"1" |

注：依靠异或运算实现

---

#### 海明校验码

        **特点**：有1位检错，1位纠错能力

        **步骤**：

1. **确定校验位个数k**：$检验位表示数2^k≥信息位n+检验位k+正确位1$

2. **确定校验位地址**：编制从1开始时，必须放在：$1、2、8、16、32...$

3. **计算校验码**：
   
   第1个校验位在第1位，将1、3、5、7...的**读1位，隔1位**信息值组成**偶校验**。
   
   即第1个校验位读取，**地址位第1数有1的**。
   
   第2个校验位在第2位，将2、3、6、7、10、11...的**读2位，隔2位**信息值组成**偶校验**。
   
   即第2个校验位读取，**地址位第2数有1的**。
   
   第3个校验位在第8位，将8、9、10、11、12、...的**读8位，隔8位**信息值组成**偶校验**。
   
   即第3个校验位读取，**地址位第3数有1的**。
   
   **使用**：进行上述各组偶校验，若全0，则无措；
   
   若非全0，则由 $[...][第2个偶校验值][第1个偶校验值]$ 组成的真值代表**出错位置**。

        **扩展**：再加1位的全校验位进行偶校验，则可以得到2位检错，1位纠错。

---

#### CRC循环冗余校验码

        **特征**：有1/3/5/7...和2位检错，可能有纠错能力

        **步骤**：

        1.**确定模2除运算对象**：直接给出，或表达式形式。如1011对应表达式$x^3+x+1$

        2.**校验位个数n、信息先补n个0**：$n=运算对象位数-1$

        3.**计算校验码**：模2除的余数

| 区别   | 除法         | 模2除           |
|:----:|:----------:|:-------------:|
| 商    | 满足小于时，商到最大 | 最高位1商1，最高位0商0 |
| 商后运算 | 减法         | 模2加运算         |

        **使用**：模2除运算对象，若全0，则无措；若非全0，则其余数可能代表**出错位置**。当校验位个数满足$2^k≥n＋k＋1$，就代表出错位置，不满足时会溢出循环。

        **优势**：校验位插入位置比海明校验码简单，计算机网络通信常用CRC校验码。

---

### 定点数

        **概念**：小数位置固定，区别于浮点数。

        **有符号、定点数的表示**

| 分类  | 说明                 | 性质                | 用处   |
|:---:|:------------------:|:-----------------:|:----:|
| 原码  | 符号位0正1负，数值位对应真值数值位 | 2个真值0表示           | 好理解  |
| 反码  | 符号位1时，原码数值位全部取反    | 1个真值0表示，范围多一个最小负数 | 无意义  |
| 补码  | 符号位1时，原码数值位全部取反+1  | 1个真值0表示，范围多一个最小负数 | 方便运算 |
| 移码  | 移码 = 真值+偏移量        | \                 | 方便比较 |

        **补码原码互转技巧**：最右边那个1不动，从其到符号位前全部取反。

---

#### 移位运算

| 分类   | 补码法则               | 原码法则 |
|:----:|:------------------:|:----:|
| 算术移位 | 负数右移时，左边补符号位1，其余补0 | 都补0  |
| 逻辑移位 | 都补0                | 都补0  |
| 循环移位 | /                  | /    |

---

#### 加减运算

        **原码**：正正\负负使用加法器、正负\负正使用减法器。

        **补码**：符号位参与运算，只用加法器。

| 补码溢出判断方法 | 上溢       | 下溢       |
|:--------:|:--------:|:--------:|
| 观察符号位    | 正正负      | 负负正      |
| 观察进位     | 最高两位进位01 | 最高两位进位10 |
| 双符号位     | 符号位01    | 符号位10    |

| 标志位          | 情况                   |
|:------------:|:--------------------:|
| 溢出位**OF**    | 溢出1，其他0              |
| 进位/借位位**CF** | 加法溢出1，其他0；减法小减大1，其他0 |

---

#### 乘法运算

        **思想**：十进制乘法算式，只用加法器。

        **原码乘法**：$X×Y = Z$

1. 初始：
   
   | 寄存器 | 存储           | 初始            |
   |:---:|:------------:|:-------------:|
   | ACC | 乘积原码$[Z]_原$  | 全0            |
   | MQ  | 乘数原码$[Y]_原$  | $[Y]_原$       |
   | X   | 被乘数原码$[X]_原$ | 符号位为0的$[X]_原$ |

2. 加法：查看MQ最低位，1则ACC加X，0则ACC不变

3. 右移：ACC和MQ右移

4. 循环：循环加法和右移，直到MQ最低位是符号位退出循环。

5. 结尾：符号位单独异或运算后，替换ACC符号位

---

        **补码乘法**：$X×Y = Z$

1. 初始：
   
   | 寄存器   | 存储                     | 初始       |
   |:-----:|:----------------------:|:--------:|
   | ACC   | 乘积补码$[Z]_补$            | 全0       |
   | MQ    | 乘数补码$[Y]_补$            | $[Y]_补$  |
   | MQ扩展位 | 在MQ结尾增加的1位，存最新的MQ右移丢弃位 | 0        |
   | X1    | 被乘数补码$[X]_补$           | $[X]_补$  |
   | X2    | 负被乘数补码$[-X]_补$         | $[-X]_补$ |

2. 加法：MQ扩展位-MQ最低位，1则ACC加X1，0则ACC不变，-1则ACC加X1

3. 右移：ACC和MQ右移

4. 循环：循环加法和右移，直到MQ最低位是符号位。

5. 结尾：多进行1步加法

---

| 区别           | 原码乘法        | 补码乘法            |
|:------------:|:-----------:|:---------------:|
| 寄存器个数        | 3（ACC/MQ/X） | 4（ACC/MQ/X1/X2） |
| 寄存器MQ        | 无扩展位        | 有扩展位            |
| X是否修改符号位     | 都修改位0       | 不动              |
| 循环中的加法对象供选择数 | 2（X/0）      | 3（X1/X2/0）      |
| 循环中的加法对象选择判断 | MQ最低位       | MQ扩展位-MQ最低位     |
| 符号位确定        | 单独运算        | 多进行1步加法         |

---

#### 除法运算

        **思想**：十进制除法算式，只用加法器。

        **原码除法（恢复余数法）**：$X÷Y=Z$

1. 初始1：
   
   | 寄存器 | 存储            | 初始            |
   |:---:|:-------------:|:-------------:|
   | ACC | 被除数$[X]_原$、余数 | 符号位为0的$[X]_原$ |
   | MQ  | 商原码$[Z]_原$    | 空             |
   | X1  | 除数$[Y]_补$     | $[Y]_补$       |
   | X2  | 除数$[-Y]_补$    | $[-Y]_补$      |

2. 初始2：因为尝试商1而ACC加X2

3. 恢复：
   
   若ACC符号位为1，则MQ确定商0，恢复，ACC加X1，ACC左移，ACC加X2。
   
   若ACC符号位为0，则MQ确定商1，不恢复，ACC左移，ACC加X2。

4. 循环：循环**恢复**，直到MQ数值位商满

5. 结尾：符号位单独异或运算，替换MQ符号位。

---

        **原码除法（加减交替法）**：$X÷Y=Z$

1. 初始1：
   
   | 寄存器 | 存储            | 初始            |
   |:---:|:-------------:|:-------------:|
   | ACC | 被除数$[X]_原$、余数 | 符号位为0的$[X]_原$ |
   | MQ  | 商原码$[Z]_原$    | 空             |
   | X1  | 除数$[Y]_补$     | $[Y]_补$       |
   | X2  | 除数$[-Y]_补$    | $[-Y]_补$      |

2. 初始2：因为尝试商1而ACC加X2

3. 交替：
   
   若ACC符号位为1，则MQ确定商0，ACC左移，ACC加X1。
   
   若ACC符号位为0，则MQ确定商1，ACC左移，ACC加X2。

4. 循环：循环**交替**，直到MQ数值位商满

5. 结尾：符号位单独异或运算，补充到MQ符号位。

        **原理**：`恢复ACC加X1，ACC左移，ACC加X2` 等效于 `ACC左移，ACC加X1`

---

        **补码除法（加减交替法）**：$X÷Y=Z$

1. 初始1：
   
   | 寄存器 | 存储            | 初始       |
   |:---:|:-------------:|:--------:|
   | ACC | 被除数$[X]_补$、余数 | $[X]_补$  |
   | MQ  | 商补码$[Z]_补$    | 空        |
   | X1  | 除数$[Y]_补$     | $[Y]_补$  |
   | X2  | 除数$[-Y]_补$    | $[-Y]_补$ |

2. 初始2：查看ACC符号，ACC加不同号的X1/X2

3. 交替：
   
   若ACC符号位与X1同号，则MQ确定商0，ACC左移，ACC加X1。
   
   若ACC符号位与X1异号，则MQ确定商1，ACC左移，ACC加X2。

4. 循环：循环**交替**，直到MQ数值位商满

   5. 结尾：无需操作，第1个商的位就是符号位。

---

| 区别          | 原码除法（交替）     | 补码除法（交替）       |
|:-----------:|:------------:|:--------------:|
| ACC被除数符号位   | 符号位都改0       | 不变             |
| 初始2         | ACC永远加X2     | ACC加的X要与之异号    |
| 商0条件，下轮循环操作 | ACC符号1，左移加X1 | ACC与X1同号，左移加X1 |
| 商1条件，下轮循环操作 | ACC符号0，左移加X2 | ACC与X1异号，左移加X2 |
| 符号位         | 单独异或运算       | 无需操作，第1个商的就是符号 |

---

### 浮点数

#### IEEE 745标准

| 位数  | float | double | long double |
|:---:|:-----:|:------:|:-----------:|
| 数符X | 1     | 1      | 1           |
| 阶码Y | 8     | 11     | 15          |
| 尾数Z | 23    | 52     | 64          |
| 整体  | 32    | 64     | 80          |

| 类别  | 含义                      |
|:---:|:-----------------------:|
| 数符  | 0正1负                    |
| 阶码  | 真值+127（$2^{n-1}-1$）的移码  |
| 尾数  | 最高位隐含1                  |
| 整体  | $(-1)^x(1.Z)×2^{Y-127}$ |

| 特殊表示            | 阶码  | 尾数  |
|:---------------:|:---:|:---:|
| 真值零             | 全0  | 全0  |
| 无穷大             | 全1  | 全0  |
| 不合法             | 全1  | 不全0 |
| 最小阶码（1），尾数最高隐含0 | 全0  | 不全0 |

---

#### 加减运算

1. 转二进制，尾数规格化，转补码

2. 对阶：求阶差，让小的尾数右规对齐

3. 尾数加减：补码加减运算

4. 对结果的尾数规格化

5. 舍入：啥都入1，或者0舍1入

6. 判溢出

---

### C语言强制类型转换

+ 符号有无转换不改变机器数，可能影响真值

+ 短变长：算术移位补数，不影响真值（无损）

+ 长变短：截断丢弃，可能影响真值

---

## CPU

### 组成

| 组成    | 内容                                |
|:-----:|:---------------------------------:|
| 运算器   | ALU算数逻辑单元、ACC累加寄存器、MQ乘商寄存器、X通用寄存器 |
| 控制器   | CU控制单元、PC指令地址寄存器、IR指令寄存器          |
| 不可见元件 | 三态门、暂存/中间寄存器                      |

---

### 性能指标

| 性能指标  | 说明              |
|:-----:|:---------------:|
| 主频    | 1s有多少个时钟周期      |
| 时钟周期  | 产生1个脉冲的时间       |
| CPI   | 执行1条指令需要多少个时钟周期 |
| IPS   | 每s执行多少条指令       |
| FLOPS | 每是执行多少次浮点运算     |
| 响应时间  | 发出请求到收到反馈的总时长   |
| 基准程序  | 跑分软件            |

---

### ALU算术逻辑单元

| ALU功能 | 说明              |
|:-----:|:---------------:|
| 算术运算  | 加法器、减法器、乘法器、除法器 |
| 逻辑运算  | 与、或、非、异或、同或     |
| 辅助功能  | 移位、求补码          |

        **实现原理**

| 逻辑门元件 | 说明        | 数学表示 | 类型  | 具体组合                                                    |
|:-----:|:---------:|:----:|:---:|:-------------------------------------------------------:|
| 与门    | 有0则0，一假则假 | ×    | 基础  | \                                                       |
| 或门    | 有1则1，一真则真 | +    | 基础  | \                                                       |
| 非门    | 取反        | _    | 基础  | \                                                       |
| 异或    | 异1同0      | ⊕    | 组合  | $\underline{A}B＋A\underline{B}$                         |
| 同或    | 同1异0      | ⊙    | 组合  | $AB＋\underline{AB}$                                     |
| 一位全加器 | 某1位的加法运算  | 无    | 组合  | $S_i＝A_i⊕B_i⊕C_{i-1}$，$C_i＝(A_iB_i)＋((A_i⊕B_i)C_{i-1})$ |

| 逻辑门运算法则   | 内容                                                                                               |
|:---------:|:------------------------------------------------------------------------------------------------:|
| 乘法分配律和结合律 | $(A+B)C = AC+AC$                                                                                 |
| 反演律（德摩根律） | $\underline{A+B}=\underline{A}×\underline{B}$   或  $\underline{A×B}=\underline{A}+\underline{B}$ |

| 加法器实现原理 | 说明                        | 具体逻辑元件       |
|:-------:|:-------------------------:|:------------:|
| 串行加法器   | 一次通电时间，实现1位加法，触发下一位加法     | 一位全加器、触发器    |
| 并行加法器   | 一次通电时间，实现一组n位加法，触发下一组n位加法 | 一位全加器、触发器、旁路 |

---

### 指令

        **概念**：是计算机的机器语言，对应一条汇编语言，计算机运行最小可选可控的功能单位。

        **指令构成**：操作码|地址码

        指令和数据**无差别存储**到存储器。

| 依据          | 分类                      |
|:-----------:|:-----------------------:|
| 所有指令的长度是否统一 | 定长指令、变长指令               |
| 地址码中的地址数量   | 三地址指令、二地址指令、一地址指令、零地址指令 |

        **扩展操作码**：在定长指令下，操作码和地址码的分界线可变。一般把定长指令划分位n层模块，以可使用的模块数划分操作码和地址码，每个模块的可用操作数个数不一定会全用，会留给下一个模块。因此有以下公式：

        $第n层操作码个数＝上层留下可用个数×本层可用个数$

#### 指令寻址

        **概念**： 找到下条指令的方法。

| 类别   | 说明                      |
|:----:|:-----------------------:|
| 顺序寻址 | 默认，由PC++支持              |
| 跳跃寻址 | 地址码给出下条指令的地址，C语言的goto语法 |

#### 数据寻址

        **概念**：找到相应数据的方法。

        **地址码构成**：寻址特征|形式地址

| 类别        | 说明                   | 访存  | 寻址类型 |
|:---------:|:--------------------:|:---:|:----:|
| 隐含寻址      | 操作数在相应操作的寄存器中，无需读取转移 | 0   | \    |
| 立即寻址      | $TD=A$               | 0   | \    |
| 直接寻址      | $TD=(A)$             | 1   | \    |
| 一次间接寻址    | $TD=((A))$           | 2   | \    |
| 寄存器寻址     | $TD=<A>$             | 0   | \    |
| 一次寄存器间接寻址 | $TD=(<A>)$           | 1   | \    |
| 基址寻址      | $TD=(A+<BR>)$        | 1   | 偏移寻址 |
| 变址寻址      | $TD=(A+<IX>)$        | 1   | 偏移寻址 |
| 相对寻址      | $TD=(A+<PC>)$        | 1   | 偏移寻址 |
| 堆栈寻址      | 寄存器实现叫硬堆栈、主存实现叫软堆栈   | /   | 堆栈寻址 |

注：$TD$目标数据，$A$形式地址，$()$访问主存，$<>$访问寄存器，$BR$基址寄存器（提供给操作系统），$IX$变址寄存器（提供给用户编程，以减少访存），$PC$程序计数器寄存器。

---

#### 指令集

| 区别    | CISC复杂指令集    | RISC简单指令集    |
|:-----:|:------------:|:------------:|
| 概念    | 1条指令完成1个复杂动作 | 1条指令完成1个简单动作 |
| 典型    | X86          | ARM          |
| 应用    | 电脑           | 手机           |
| 操作码解析 | 微程序          | 硬布线          |

---

#### 指周期令

        **概念**：一条指令的执行可划分为下列几种周期：

| 通用周期 | 执行的微操作                                             |
|:----:|:--------------------------------------------------:|
| 取指周期 | (PC)→MAR，1→R，M(MAR)→MDR，MDR→IR，Op(IR)→CU，(PC)+1→PC |
| 间址周期 | Ad(IR)→MAR，1→R，M(MAR)→MDR，MDR→IR                   |
| 中断周期 | a→MAR，(PC)→MDR，1→W，MDR→M(MAR)，向量地址→PC              |

        **更多周期**：计算周期、访存周期等等

        **周期控制**：标志触发器FE、IND、EX、INT

| 指令执行方案 | 说明                   |
|:------:|:--------------------:|
| 单周期指令  | 1条指令由1个时钟周期完成        |
| 多周期指令  | 1条指令由n个时钟周期完成        |
| 流水线指令  | 1条指令由n个时钟周期完成，且使用流水线 |

        **微操作**：完成**一次信号传递**的指令/操作。详细格式如下：

| 时序  | 微操作          | 控制信号/线路开关   | 说明          |
|:---:|:------------:|:-----------:|:-----------:|
| 1   | （PC)→Bus→MAR | PCout、MARin | 将PC地址放到MAR中 |

        **数据通路**：指数据总线，路径上的部件都是数据通路部件，由控制信号控制

---

#### 指令流水线

| 术语   | 说明                 |
|:----:|:------------------:|
| 过程图  | 指令Y轴-时间X轴，增长走势往斜方向 |
| 时空图  | 资源Y轴-时间X轴，增长走势往横方向 |
| 装入时间 | 开始有部件空闲的时间         |
| 排空时间 | 末尾有部件空闲的时间         |
| 加速比  | 不用流水线时间÷用流水线时间     |
| 效率   | 一段时间内所有部件工作时间的占比   |

| 冲突分类       | 说明              | 解决方案 |
|:----------:|:---------------:|:----:|
| 结构相关（资源冲突） | 同时访问同个互斥部件      | 增加部件 |
| 数据相关（数据冲突） | 下一任务用到前一任务的处理数据 | 建立旁路 |
| 控制相关（控制冲突） | 存在跳跃寻址          | 分支预测 |

| 流水线技术升级 | 说明                 |
|:-------:|:------------------:|
| 超标量技术   | 成套增加部件数、如多核心多线程    |
| 超流水线技术  | 将指令周期继续细分          |
| 超长指令字   | 相同操作码不同地址的合成一条超长指令 |

---

### CU控制单元

        **概念**：解析执行指令中的**操作码**所规定的内容

| 组成类别  | 内容                        |
|:-----:|:-------------------------:|
| 信号处理  | 操作码寄存器、时钟、标志、外来信号、电路实现    |
| 输出信号线 | 到CPU内部的控制信号线、到CPU外部的控制信号线 |

        **解析执行方案**：硬布线、微程序

#### 硬布线

        **概念**：操作码由组合逻辑电路来实现。用于**RISC**。

        **流程示意**：$指令操作码→逻辑电路→多个微操作$

| 控制方式   | 说明   |
|:------:|:----:|
| 同步控制方式 | 统一时钟 |
| 异步控制方式 | 应答方式 |
| 联合控制方式 | 折中   |

        **微操作时序安排原则**：

1. 先后顺序不能颠倒

2. 不冲突排同一节拍

3. 用时短有先后的也可排同一节拍

| 逻辑电路组合                          |
|:-------------------------------:|
| $取指周期×该周期控制信号＋间址周期×该周期控制信号＋...$ |

#### 微程序

        **概念**：CU作为小CPU，对操作码的处理，调用其专门存储器中的微程序实现，用户**CISC**。

        **流程示意**：$指令操作码→多个微指令→调用微程序→多个微操作$

| 操作码划分依据 | 内容                   |
|:-------:|:--------------------:|
| 相容性微操作  | 可同时执行的微指令，设计成操作码的一块  |
| 互斥性微操作  | 不能同时执行的微指令，设计成操作码的多块 |

| 操作码编码方式 | 内容                      |
|:-------:|:-----------------------:|
| 直接编码    | 1位操作码1微指令               |
| 字段直接编码  | 使用译码器要分段$n$位操作码$2^n$微指令 |
| 字段间接编码  | 使用多层译码器                 |

        **微指令调用存储器中微程序，需要地址，其地址形成方式**：下地址字段、操作码解析、增量计数器法、分支转移、测试网络、硬件产生

---

## 存储器

### 组成

| 组成       | 内容                             | 是否常用于画图 |
|:--------:|:------------------------------:|:-------:|
| 存储元      | 存1位信息的物理元件，如电容                 | 否       |
| 存储单元     | 由n个存储元组成，1个存储单元对应1个地址          | 否       |
| 存储体      | 由n个存储单元组成的模块                   | 是       |
| 地址寄存器MAR | $n$位可对应$2^n$个存储单元，常用**行列矩阵选通** | 是       |
| 数据寄存器MDR | 对应1个存储单元位数，读写的缓存空间             | 是       |
| 地址线      | MAR选通对应存储单元的线                  | 是       |
| 数据线      | 存储单元与MDR通信的线                   | 是       |
| 片选线      | 选通某个存储体的线                      | 是       |
| 读写控制线    | 本次是读是写，控制数据线传送方向的线             | 是       |

### 容量单位

| 容量单位 | 表示字母 | 全称                  | 转换    |
|:----:|:----:|:-------------------:|:-----:|
| 比特   | b    | bit                 | \     |
| 字节   | B    | Byte                | 1B=8b |
| 字    | \    | 操作系统/PC寄存器是32位还是64位 | \     |

| 量级单位 | 转换（容量上）      | 转换（速度上）          |
|:----:|:------------:|:----------------:|
| K    | 1KB = 1024B  | 1KB/s = 1000B/s  |
| M    | 1MB = 1024KB | 1MB/s = 1000KB/s |
| G    | 1GB = 1024MB | 1GB/s = 1000MB/s |
| T    | 1TB = 1024GB | 1TB/s = 1000GB/s |
| P    | 1PB = 1024TB | 1PB/s = 1000TB/s |
| E    | 1EB = 1024PB | 1EB/s = 1000PB/s |

- 家用宽带百兆带宽，即100Mb/s，实际上只有12.5MB/s。

- 2016年的神威太湖之光超级计算机，其浮点运算速度93PFLOPS，即每s运算9.3×10^{16}次浮点运算。

---

### 编址与对齐

| 术语    | 说明                    |
|:-----:|:---------------------:|
| 按字节编制 | 1个地址共8b               |
| 按字编制  | 1个地址共32b/64b          |
| 大端模式  | 符合人类阅读习惯的信息排序         |
| 小端模式  | 以地址位单位，将人类阅读习惯的信息序列倒序 |
| 边界对齐  | 将所有数据类型的数据放在能一次读写的位置  |

---

### 分类

| 分类依据   | 类别                      |
|:------:|:-----------------------:|
| 材料     | 半导体存储器、磁表面存储器、光盘存储器     |
| 速度     | 随机存储（半导体）、直接存储、顺序存储（磁带） |
| 断电丢失否  | 易失性(RAM)，非易失性           |
| 是否IO设备 | 内存（RAM）、外存（ROM、其他）      |

注：IO设备的其他存储器放在IO设备的章节

---

### 性能指标

| 指标     | 说明            |
|:------:|:-------------:|
| 存储周期长度 | 1个存储周期可进行1次读写 |
| 数据带宽   | 1次能同时读写多少多少位  |
| 存储速度   | 1s能读写多少bit信息  |

---

### 半导体存储器

#### RAM

        **概念**：（易失）随机存储器

| 区别      | 静态随机存储器SRAM                 | 动态随机存储器DRAM                 |
|:-------:|:---------------------------:|:---------------------------:|
| 存储元电子元件 | 触发器（双稳态）                    | 电容（充放电）                     |
| 读的破坏性   | 非破坏性读，无需刷新                  | 破坏性读，要刷新，刷新期间不能读写           |
| 速度      | 快                           | 慢                           |
| 集成度/成本  | 低，1个SRAM存储元需要6个逻辑元件，发热大，成本高 | 高，1个DRAM存储元只需3个逻辑元件，发热小，成本低 |
| 用途      | Cache                       | 主存                          |

+ 当代用的主存都是SDRAM同步动态随机存储器

+ DRAM是使用行列矩阵选通存储单元，**一次可刷新一行**。

+ DRAM的刷新时机：分散刷新(间隔分布)、集中刷新、异步刷新(均匀分布)

---

#### ROM

        **概念**：只读随机存储器

| 发展历程  | 说明       |
|:-----:|:--------:|
| 掩膜式   | 出厂确定内容   |
| 1次可编程 | 用户可以写入1次 |
| 可擦除   | 可改但很慢    |
| 闪存    | 可改且很快    |
| 固态    | 增加控制单元   |

---

### 多体并行存储器

        **概念**：存储结构内部分块，每分块都有独自的MDR/MAR/地址译码器等结构，可以按流水线并行工作。

        **编址**：**高位交叉编址**，**低位交叉编址**（按顺序访问地址此最优）

        **流水线**：分配时间、分块数量、存储周期之间的设计，能让每个任务的完成时间接近分配时间，具体公式为：

        $总用时=（任务数-1）×分配时间+存储周期$

                        $≈任务数×分配时间$

| 情况               | 特点           |
|:----------------:|:------------:|
| $分块数量=存储周期/分配时间$ | 存储块高利用率，速度最快 |
| $分块数量>存储周期/分配时间$ | 存储块低利用率，速度最快 |
| $分块数量<存储周期/分配时间$ | 存储块高利用率，速度最慢 |

---

### Cache缓存原理

| 原理    | 详情                           |
|:-----:|:----------------------------:|
| 空间局部性 | 未来要使用的信息，可推断是现在使用信息的**邻近信息** |
| 时间局部性 | 未来要使用的信息，可推断是现在使用信息的**重复调用** |

| 术语       | 说明                                              |
|:--------:|:-----------------------------------------------:|
| 命中率      | CPU访问Cache就得到需要信息的概率                            |
| 访存策略     | 同时访存Cache和主存，先访存Cache再访存主存                      |
| 系统效率     | 一段时间内的工作时间占比                                    |
| Cache行/块 | 一次搬入主存内目标信息和邻近信息的**主存块大小**，是主存与Cache**交换的基本单位** |

        因为Cache很小，主存很大，主存输入搬入Cache时，需要**主存标记位**记录主存的高位地址，中位地址按**策略映射**Cache行号，低位地址可直接映射**Cache行内地址**，映射策略：

| 映射策略  | 映射部分              | 存放限制 |
|:-----:|:-----------------:|:----:|
| 全相联映射 | Cache行号都不映射主存中位地址 | 无限制  |
| 直接映射  | Cache行号都映射主存中位地址  | 限制最高 |
| 组相连映射 | Cache行号部分映射主存中位地址 | 限制中等 |

        还需要考虑无位置时的替换，和写回主存的策略问题：

| 替换算法      | 说明                                           |
|:---------:|:--------------------------------------------:|
| 随机替换      | 效果不好                                         |
| FIFO先进先出  | 当循环体大于Cache行时非常糟糕                            |
| LRU近期最少使用 | 局部统计法，统计最近一段时间的访问次数，替换最少访问的出去，算法位要求大，同时需要排序。 |
| LFU频繁使用最少 | 全局统计法，统计总访问次数，替换最少访问的出去，算法位要求大，同时需要排序。       |

| 写策略   | 说明                                         |
|:-----:|:------------------------------------------:|
| 写回法   | 命中时，只写Cache，等替换出去时再考虑写回主存，需**1位脏位**标记是否修改过 |
| 写分配法  | 不命中时，读主存到Cache，后续同写回法                      |
| 全写法   | 命中时，同时写Cache和主存                            |
| 非写分配法 | 不命中时，直接通过写缓存写回去主存                          |

注：实际应用搭配使用，L1缓存全写法，L2缓存写回法

| Cache常见计算                         |
|:--------------------------------- |
| $Cache行数=Cache数据区大小÷主存块大小$        |
| $Cache行内地址数量=主存块大小÷存储字长$          |
| $Cache数据区地址组成=行号\vert 行内地址$       |
| $Cache行大小=有效位+算法位+脏位+主存标记位+主存块大小$ |

| 大小类别     | 区分             |
|:--------:|:--------------:|
| 主存块大小    | 1个Cache行的数据区大小 |
| Cache行大小 | 主存块大小+所有标记位    |
| 数据区大小    | 所有Cache行的数据区大小 |

---

## 总线

        **概念**：多个部件分时共享的公共信息传送线路，可灵活增加设备

| 依据      | 分类                                   |
|:-------:|:------------------------------------:|
| 总线位宽    | 串行总线（快），并行总线（频率高产生干扰）                |
| 总线所处位置  | 片内总线，系统总线，通信总线                       |
| 总线结构/线数 | 单总线（容易过载），双总线（增加IO设备总线），三总线（增加DMA总线） |

        **桥接器**：高速总线与低速总线的连接部件。

---

### 性能指标

| 性能指标术语       | 内容                                   |
|:------------:|:------------------------------------:|
| 总线时钟周期       | 产生1个脉冲的时间                            |
| 总线时钟频率       | 1s内多少个时钟周期                           |
| 总线周期         | 申请阶段、寻址阶段、传输阶段、结束阶段，1次数据传输的时间        |
| **总线工作频率**   | 1s内多少个总线周期，1s内传输多少次数据                |
| **总线宽度**     | 总线位宽，可看出串行/并行，同时传输数据的位数              |
| **总线带宽**     | 总线速度，总线工作频率×总线宽度                     |
| **有效传输率**    | 去除校验位等无效信息，指有效信息位的占比                 |
| **总线复用**     | 不同时间传输不同信号，如地址线和数据线共用                |
| **信号线数**     | 指地址总线、数据总线、控制总线的分类数                  |
| **总线突发传输方式** | 1次总线事务中，只需传输一个首地址，设备能给出从首地址开始的连续若干数据 |

---

### 总线仲裁

        **概念**：总线周期分**申请周期、寻址周期、传输周期、结束周期**，总线的仲裁即总线的寻址周期，**独立响应**需要更多的允许线，减少允许线可用**轮询技术**。

        n个接入设备时，总线允许/请求/忙线的控制线路数量：

| 方式      | 总线允许线    | 总线请求线 | 总线忙线 | 说明            |
|:-------:|:--------:|:-----:|:----:|:-------------:|
| 链式查询方式  | $1$      | $1$   | $1$  | 轮询、导致饥饿       |
| 计数器查询方式 | $log_2n$ | $1$   | $1$  | 轮询、计数器CLOCK循环 |
| 独立请求方式  | $n$      | $n$   | $1$  | 使用队列          |

        总线仲裁还可根据集中与否分类：

| 分类    | 说明        |
|:-----:|:---------:|
| 集中式仲裁 | 控制部件总线上   |
| 分布式仲裁 | 控制部件在各设备上 |

---

### 总线定时

        概念：解决主模块和从模块间的通信方式。

| 方式     | 说明                                  |
|:------:|:-----------------------------------:|
| 同步定时通信 | 统一时钟下，各传各的，各收各的                     |
| 异步定时通信 | 没有统一时钟，分不**互锁/半互锁/全互锁**(一次/二次/三次握手) |
| 半同步通信  | 统一时钟的基础上增加等待信号                      |
| 分离式通信  | 将等待从模块数据没使用总线的时间让出来，提高利用率           |

---

### 总线标准

| 名称        | 类别    | 特点                                                |
|:---------:|:-----:|:-------------------------------------------------:|
| ISA       | 总线    | 数据传输需要CPU和DMA管理                                   |
| EISA      | 总线    | 优化ISA，并行总线，突发传送，分离CPU总线控制权                        |
| PCI       | 总线    | 突发传输，兼容ISA/EISA，即插即用，仲裁能力，奇偶校验，并行操作，扩充性好，支持多路复用技术 |
| **PCI-E** | 总线    | 优化PCI，E是高速的意思，**串行**总线，热拔插                        |
| AGP       | 总线    | inter图形加速接口，显卡接口                                  |
| **USB**   | 总线    | 热插拔，即插即用，菊花链式扩充，支持IDE、可供电5V、**串行**总线              |
| RS-232C   | 总线    | 串行二进制交换的数据终端设备和数据通信设备标准接口，属通信总线                   |
| IDE       | 总线    | 连硬盘和光驱，并行总线                                       |
| **SATA**  | 总线    | 连硬盘和光驱，**串行**总线                                   |
| SCSI      | 总线    | 连硬盘、光驱、打印机、扫描仪的智能通用接口                             |
| PCMCIA    | 总线    | PC卡，便携设备接口                                        |
| VGA       | 视频传输线 | 传输模拟信号线                                           |
| DVI       | 视频传输线 | 传输数字信号线                                           |
| **HDMI**  | 视频传输线 | 常用                                                |

        **即插即用**：自带设备驱动程序，自动配置。

        **热插拔**：带电插拔

---

## IO设备

| 分类      | 内容                 |
|:-------:|:------------------:|
| 输入设备    | 键盘、鼠标              |
| 输出设备    | 显示器、打印机            |
| 输入/输出设备 | 磁盘机                |
| I/O外存   | 磁表面存储器、光表面存储器、固态硬盘 |

---

### 显示器

| 性能指标      | 说明                                    |
|:---------:|:-------------------------------------:|
| 屏幕大小      | 物理大小                                  |
| 分辨率       | 像素点个数                                 |
| 灰度级       | 能够表示不同颜色的位数                           |
| 刷新率       | 由VRAM最大带宽支持                           |
| 显示存储器VRAM | $VRAM容量＝分辨率×灰度级位数$,$VRAM带宽＝VRAM容量×帧频$ |

注：VRAM容量是表示一张画面的存储容量，VRAM带宽是要满足某帧率的显示所需的传输速度。

| 依据  | 类别                             |
|:---:|:------------------------------:|
| 材料  | CRT阴极射线管、LCD液晶显示器、LED发光二极管     |
| 扫描  | 光栅扫描（每个像素点都扫描）、随机扫描（只扫描某个变化区域） |

---

### 打印机

| 依据   | 分类                 |
|:----:|:------------------:|
| 原理   | 击打式打印机、非击打式打印机     |
| 工作方式 | 针式打印机、喷墨式打印机、激光打印机 |

---

### 磁盘

        **编址**：**驱动器号|柱面号|盘面号|扇区号**

        **最小读写单位**：扇区

| 性能指标  | 说明                              |
|:-----:|:-------------------------------:|
| 道密度   | 每个柱面号间的间隔                       |
| 位密度   | 每个比特位之间的间隔                      |
| 面密度   | 道密度×位密度                         |
| 存取时间  | 启动(译码)时间＋移动(寻道)时间＋旋转(寻位)时间＋传输时间 |
| 数据传输率 | 转速×每条磁道容量                       |

---

### IO接口

| 概念   | 内容                                        |
|:----:|:-----------------------------------------:|
| 接口功能 | 设备选址，传送命令、传送数据(格式转换)、反映设备状态               |
| 接口结构 | 设备选择电路、命令寄存器和译码器、数据缓存寄存器DBR、设备状态标记、控制逻辑电路 |
| 接口编址 | 统一编址、独立编址                                 |
| 接口分类 | 并行/串行，程序查询方式/程序中断方式/DMA方式，可编程/不可编程        |

| 属于否      | 类别                                             |
|:--------:|:----------------------------------------------:|
| 属于IO接口   | 网络**适配器**/网络**控制器**/网卡、打印机**适配器**、可编程中继**控制器** |
| 不属于I/O接口 | 磁盘**驱动器**、磁盘机                                  |

### IO总线

+ 地址线是**单向的**

+ 数据线是向CPU传输一切数据的通路
